<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitSense AI | Mobile Fitness</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- MediaPipe Pose for real-time human pose estimation -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script defer src="script.js"></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="top-bar">
        <div class="brand">
          <span class="dot"></span>
          FitSense AI
        </div>
        <div class="status-pill" id="ai-status">KI bereit</div>
      </header>

      <main>
        <section id="dashboard" class="view active">
          <div class="hero-card">
            <div>
              <p class="eyebrow">Dein Tag</p>
              <h1>Starte Training oder scanne deine Mahlzeit</h1>
              <p class="subtext">
                Mobile First, klare Sprache, KI-unterst√ºtzt ‚Äì ohne manuelles Tracking.
              </p>
              <div class="quick-actions">
                <button class="btn primary" data-nav-target="training">Training scannen</button>
                <button class="btn ghost" data-nav-target="nutrition">Mahlzeit scannen</button>
              </div>
            </div>
            <div class="hero-score">
              <p class="eyebrow">Streak</p>
              <div id="streak-score" class="big-number">0</div>
              <p class="muted">Tage aktiv</p>
            </div>
          </div>

          <div class="card-grid">
            <article class="card">
              <div class="card-title">Training</div>
              <div class="card-value">
                <span id="today-reps">0</span> Wiederholungen
              </div>
              <p class="muted" id="tech-score">Technik-Score: 0%</p>
            </article>
            <article class="card">
              <div class="card-title">Ern√§hrung</div>
              <div class="card-value">
                <span id="today-calories">0</span> kcal
              </div>
              <p class="muted" id="today-protein">Protein: 0 g</p>
            </article>
            <article class="card">
              <div class="card-title">Regeneration</div>
              <div class="card-value" id="recovery-hint">Bereit f√ºr eine Session</div>
              <p class="muted">Erkenne Form & Pausen automatisch</p>
            </article>
          </div>

          <section class="list-block">
            <div class="block-header">
              <h2>N√§chste Session</h2>
              <button class="tiny-btn" data-nav-target="plan">Plan pr√ºfen</button>
            </div>
            <div id="next-session" class="pill-list"></div>
          </section>

          <section class="list-block">
            <div class="block-header">
              <h2>Letzte Aktivit√§ten</h2>
              <button class="tiny-btn" data-nav-target="training">Details</button>
            </div>
            <div id="recent-activity" class="activity-list"></div>
          </section>
        </section>

        <section id="training" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">KI-Bewegungserkennung</p>
              <h2>Live-Training mit Kamera</h2>
              <p class="muted">
                KI erkennt √úbung, Wiederholungen und Tempo. Feedback bleibt unten sticky.
              </p>
            </div>
            <label class="chip">
              √úbung
              <select id="exercise-select">
                <option value="Kniebeugen">Kniebeugen</option>
                <option value="Liegest√ºtze">Liegest√ºtze</option>
                <option value="Kreuzheben (leichte KH)">Kreuzheben (leichte KH)</option>
                <option value="Rows mit Band">Rows mit Band</option>
              </select>
            </label>
            <label class="chip">
              Kamera
              <select id="camera-facing">
                <option value="environment">R√ºckkamera</option>
                <option value="user">Frontkamera</option>
              </select>
            </label>
          </header>

          <div class="camera-panel">
            <video id="camera-feed" playsinline muted></video>
            <canvas id="skeleton-canvas"></canvas>
            <div class="camera-overlay">
              <div class="badge" id="camera-status">Kamera inaktiv</div>
              <div class="feedback" id="training-feedback">
                <p class="title">Starte das Tracking</p>
                <p class="muted">KI √ºberwacht Haltung & Bewegungsradius</p>
              </div>
              <div class="rep-counter">
                <p class="eyebrow">Wiederholungen</p>
                <div id="rep-count" class="big-number">0</div>
                <p id="tempo-info" class="muted">Tempo: ‚Äî</p>
              </div>
            </div>
          </div>

          <div class="controls">
            <button class="btn primary" id="start-training">KI-Tracking starten</button>
            <button class="btn ghost" id="pause-training">Pause</button>
            <button class="btn secondary" id="save-set">Satz speichern</button>
            <button class="btn" id="stop-training" style="background: #dc2626; color: white;">Training beenden</button>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>S√§tze & Technik</h3>
              <span class="muted">Automatisch erfasst</span>
            </div>
            <div id="sets-list" class="stack"></div>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Pose Replay</h3>
              <button class="tiny-btn" id="play-replay">Replay ansehen</button>
            </div>
            <div id="replay-log" class="stack"></div>
          </div>
        </section>

        <section id="nutrition" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Food Scan</p>
              <h2>Mahlzeit scannen & Makros</h2>
              <p class="muted">
                Foto aufnehmen oder hochladen. KI erkennt Zutaten, Portion und Makros. Du kannst korrigieren.
              </p>
            </div>
            <label class="chip">
              Portion
              <input type="range" id="portion-slider" min="0.5" max="2" step="0.1" value="1" />
            </label>
          </header>

          <div class="upload-card">
            <label class="upload-area">
              <input type="file" id="food-input" accept="image/*" capture="environment" />
              <div>
                <p class="title">Mahlzeit fotografieren</p>
                <p class="muted">Automatische Analyse der Lebensmittel</p>
              </div>
            </label>
            <div class="preview">
              <img id="food-preview" alt="Food Preview" />
              <div id="food-details"></div>
            </div>
            <button class="btn primary" id="save-food">Zum Tagebuch hinzuf√ºgen</button>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Tagebuch</h3>
              <span class="muted">Kalorien & Makros</span>
            </div>
            <div id="food-log" class="stack"></div>
          </div>
        </section>

        <section id="plan" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Planer</p>
              <h2>Automatisch generierter Trainingsplan</h2>
              <p class="muted">
                KI ber√ºcksichtigt Ziel, Level, Frequenz und Equipment. Anpassungen jederzeit m√∂glich.
              </p>
            </div>
          </header>

          <form id="plan-form" class="card form-card">
            <div class="form-grid">
              <label>
                Alter
                <input type="number" id="age" min="16" max="90" value="28" />
              </label>
              <label>
                Geschlecht
                <select id="gender">
                  <option value="divers">Divers</option>
                  <option value="weiblich">Weiblich</option>
                  <option value="m√§nnlich">M√§nnlich</option>
                </select>
              </label>
              <label>
                Gr√∂√üe (cm)
                <input type="number" id="height" min="140" max="210" value="178" />
              </label>
              <label>
                Gewicht (kg)
                <input type="number" id="weight" min="45" max="160" value="75" />
              </label>
              <label>
                Level
                <select id="level">
                  <option value="anf√§nger">Anf√§nger</option>
                  <option value="mittel">Mittel</option>
                  <option value="fortgeschritten">Fortgeschritten</option>
                </select>
              </label>
              <label>
                Ziel
                <select id="goal">
                  <option value="aufbau">Muskelaufbau</option>
                  <option value="fatloss">Fettabbau</option>
                  <option value="performance">Performance</option>
                </select>
              </label>
              <label>
                H√§ufigkeit (pro Woche)
                <input type="number" id="frequency" min="2" max="6" value="3" />
              </label>
              <label>
                Verf√ºgbare Ger√§te
                <select id="equipment">
                  <option value="k√∂rpergewicht">K√∂rpergewicht</option>
                  <option value="kurzhanteln">Kurzhanteln</option>
                  <option value="studio">Studio (volle Ausstattung)</option>
                </select>
              </label>
            </div>
            <button class="btn primary full" type="submit">Plan aktualisieren</button>
          </form>

          <div class="card log-card">
            <div class="block-header">
              <h3>W√∂chentlicher Plan</h3>
              <span class="muted" id="plan-summary">Aktualisiert</span>
            </div>
            <div id="plan-days" class="stack"></div>
          </div>
        </section>

        <section id="profile" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Datenschutz & Ger√§te</p>
              <h2>Profil & Einstellungen</h2>
              <p class="muted">Kamera-Opt-in, Einheiten, Wearables.</p>
            </div>
          </header>
          <div class="card form-card">
            <label class="toggle">
              <span>Kamera f√ºr Training erlauben</span>
              <input type="checkbox" id="camera-consent" />
            </label>
            <label class="toggle">
              <span>Push-Hinweise & Vibration</span>
              <input type="checkbox" id="notification-toggle" checked />
            </label>
            <label class="toggle">
              <span>Wearable verbunden</span>
              <input type="checkbox" id="wearable-toggle" />
            </label>
            <p class="muted small">
              Consent kann jederzeit ge√§ndert werden. Rohvideos werden nicht gespeichert ‚Äì nur Keypoints oder Snapshots nach Zustimmung.
            </p>
          </div>
          
          <div class="card form-card">
            <div class="block-header">
              <h3>KI-Einstellungen</h3>
              <span class="muted">API Key (Gemini)</span>
            </div>
            
            <p class="muted small" style="padding: 12px; background: #fef3c7; border-radius: 8px; color: #92400e; margin-bottom: 16px;">
              <strong>‚ö†Ô∏è Sicherheitshinweis:</strong> Der API-Schl√ºssel wird NUR in diesem Tab gespeichert und geht nach Seiten-Reload verloren. Er wird NIEMALS an unseren Server gesendet.
            </p>
            
            <div id="api-status-container" style="margin-bottom: 16px;">
              <div id="api-status-display" style="padding: 12px; border-radius: 8px; background: #f1f5f9; margin-bottom: 12px;">
                <strong>Status:</strong> <span id="api-status-text">Nicht gesetzt</span><br/>
                <span id="api-status-details" class="muted small">Bitte gib deinen Gemini API Key ein</span>
              </div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                API Key eingeben
              </label>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input 
                  type="password" 
                  id="api-key-input" 
                  placeholder="AIza..." 
                  style="flex: 1; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: monospace;"
                />
                <button 
                  id="toggle-api-key-visibility" 
                  class="tiny-btn" 
                  style="padding: 8px 12px; cursor: pointer;"
                  title="Anzeigen/Verbergen"
                >
                  üëÅÔ∏è
                </button>
              </div>
              <p class="muted small" style="margin-top: 4px;">
                Der Key wird nicht gespeichert und geht nach Seiten-Reload verloren.
              </p>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
              <button class="btn primary" id="set-api-key" style="flex: 1; min-width: 150px;">
                ‚úÖ Key setzen / Speichern (nur f√ºr diese Sitzung)
              </button>
              <button class="btn secondary" id="delete-api-key" style="flex: 1; min-width: 150px;">
                üóëÔ∏è Key l√∂schen
              </button>
            </div>
            
            <div style="border-top: 1px solid #e2e8f0; padding-top: 16px; margin-top: 16px;">
              <button class="btn secondary" id="test-food-scanner" style="width: 100%;">
                üîç Food Scanner testen
              </button>
              <p class="muted small" style="margin-top: 8px;">
                Letzter Test: <span id="api-last-test">Noch nicht getestet</span>
              </p>
            </div>
            
            <p class="muted small" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
              <strong>Setup-Anleitung:</strong><br/>
              1. Besuche <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">Google AI Studio</a><br/>
              2. Erstelle einen neuen API Key<br/>
              3. Kopiere den Key und f√ºge ihn oben ein<br/>
              4. Klicke auf "Key setzen"<br/>
              5. Teste die Verbindung mit dem Test-Button
            </p>
          </div>
        </section>
      </main>

      <nav class="bottom-nav">
        <button class="nav-btn active" data-target="dashboard">Dashboard</button>
        <button class="nav-btn" data-target="training">Training</button>
        <button class="nav-btn" data-target="nutrition">Ern√§hrung</button>
        <button class="nav-btn" data-target="plan">Plan</button>
        <button class="nav-btn" data-target="profile">Profil</button>
      </nav>
    </div>
  </body>
</html>
