<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitSense AI | Mobile Fitness</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- MediaPipe Pose for real-time human pose estimation -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script defer src="script.js"></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="top-bar">
        <div class="brand">
          <span class="dot"></span>
          FitSense AI
        </div>
        <div class="status-pill" id="ai-status">KI bereit</div>
      </header>

      <main>
        <section id="dashboard" class="view active">
          <div class="hero-card">
            <div>
              <p class="eyebrow">Dein Tag</p>
              <h1>Starte Training oder scanne deine Mahlzeit</h1>
              <p class="subtext">
                Mobile First, klare Sprache, KI-unterstützt – ohne manuelles Tracking.
              </p>
              <div class="quick-actions">
                <button class="btn primary" data-nav-target="training">Training scannen</button>
                <button class="btn ghost" data-nav-target="nutrition">Mahlzeit scannen</button>
              </div>
            </div>
            <div class="hero-score">
              <p class="eyebrow">Streak</p>
              <div id="streak-score" class="big-number">0</div>
              <p class="muted">Tage aktiv</p>
            </div>
          </div>

          <!-- Gamification: Level Card -->
          <div class="level-card">
            <div class="level-header">
              <div>
                <p class="level-label">Level</p>
                <div id="user-level-number" class="level-number">1</div>
              </div>
              <div style="text-align: right;">
                <p class="level-label">XP Progress</p>
                <p id="xp-text" class="xp-text">0 / 500 XP</p>
              </div>
            </div>
            <div class="level-progress-container">
              <div class="level-progress-bar">
                <div id="level-progress-fill" class="level-progress-fill" style="width: 0%"></div>
              </div>
            </div>
          </div>

          <!-- Gamification: Body Muscle Heatmap -->
          <div class="bodygraph-container">
            <svg viewBox="0 0 200 400" width="200" height="400" xmlns="http://www.w3.org/2000/svg">
              <!-- Legs -->
              <path id="poly-legs" 
                    d="M 85 240 L 75 250 L 70 300 L 65 350 L 70 380 L 80 395 L 85 395 L 90 380 L 95 350 L 90 300 L 85 250 Z M 115 240 L 125 250 L 130 300 L 135 350 L 130 380 L 120 395 L 115 395 L 110 380 L 105 350 L 110 300 L 115 250 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Chest -->
              <path id="poly-chest" 
                    d="M 80 120 L 70 130 L 65 150 L 70 170 L 85 180 L 100 180 L 115 180 L 130 170 L 135 150 L 130 130 L 120 120 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Back (visible as wings/shoulders from front) -->
              <path id="poly-back" 
                    d="M 60 130 L 50 140 L 45 160 L 50 180 L 60 190 L 70 185 L 70 170 L 65 150 Z M 140 130 L 150 140 L 155 160 L 150 180 L 140 190 L 130 185 L 130 170 L 135 150 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Shoulders -->
              <path id="poly-shoulders" 
                    d="M 70 110 L 60 120 L 55 130 L 60 140 L 70 145 L 80 140 L 80 120 Z M 130 110 L 140 120 L 145 130 L 140 140 L 130 145 L 120 140 L 120 120 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Arms -->
              <path id="poly-arms" 
                    d="M 55 145 L 45 160 L 40 180 L 35 200 L 40 220 L 50 225 L 60 220 L 65 200 L 60 180 L 55 160 Z M 145 145 L 155 160 L 160 180 L 165 200 L 160 220 L 150 225 L 140 220 L 135 200 L 140 180 L 145 160 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Core (Abs) -->
              <path id="poly-core" 
                    d="M 85 180 L 75 190 L 70 210 L 75 230 L 85 240 L 100 240 L 115 240 L 125 230 L 130 210 L 125 190 L 115 180 Z"
                    fill="#1e293b" 
                    stroke="#334155" 
                    stroke-width="1"/>
              
              <!-- Head (for completeness) -->
              <ellipse cx="100" cy="90" rx="25" ry="30" fill="#1e293b" stroke="#334155" stroke-width="1"/>
            </svg>
          </div>

          <!-- Gamification: Muscle Mastery List -->
          <div class="mastery-list-container">
            <div class="block-header">
              <h3>Muscle Mastery</h3>
            </div>
            <div id="mastery-list" class="mastery-list">
              <span class="mastery-item">Legs: Unranked</span>
              <span class="mastery-item">Chest: Unranked</span>
              <span class="mastery-item">Back: Unranked</span>
              <span class="mastery-item">Shoulders: Unranked</span>
              <span class="mastery-item">Arms: Unranked</span>
              <span class="mastery-item">Core: Unranked</span>
            </div>
          </div>

          <div class="card-grid">
            <article class="card">
              <div class="card-title">Training</div>
              <div class="card-value">
                <span id="today-reps">0</span> Wiederholungen
              </div>
              <p class="muted" id="tech-score">Technik-Score: 0%</p>
            </article>
            <article class="card">
              <div class="card-title">Ernährung</div>
              <div class="card-value">
                <span id="today-calories">0</span> kcal
              </div>
              <p class="muted" id="today-protein">Protein: 0 g</p>
            </article>
            <article class="card">
              <div class="card-title">Regeneration</div>
              <div class="card-value" id="recovery-hint">Bereit für eine Session</div>
              <p class="muted">Erkenne Form & Pausen automatisch</p>
            </article>
          </div>

          <section class="list-block">
            <div class="block-header">
              <h2>Nächste Session</h2>
              <button class="tiny-btn" data-nav-target="plan">Plan prüfen</button>
            </div>
            <div id="next-session" class="pill-list"></div>
          </section>

          <section class="list-block">
            <div class="block-header">
              <h2>Letzte Aktivitäten</h2>
              <button class="tiny-btn" data-nav-target="training">Details</button>
            </div>
            <div id="recent-activity" class="activity-list"></div>
          </section>
        </section>

        <section id="training" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">KI-Bewegungserkennung</p>
              <h2>Live-Training mit Kamera</h2>
              <p class="muted">
                KI erkennt Übung, Wiederholungen und Tempo. Feedback bleibt unten sticky.
              </p>
            </div>
            <label class="chip">
              Übung
              <select id="exercise-select">
                <option value="Kniebeugen">Kniebeugen</option>
                <option value="Liegestütze">Liegestütze</option>
                <option value="Kreuzheben (leichte KH)">Kreuzheben (leichte KH)</option>
                <option value="Rows mit Band">Rows mit Band</option>
              </select>
            </label>
            <label class="chip">
              Kamera
              <select id="camera-facing">
                <option value="environment">Rückkamera</option>
                <option value="user">Frontkamera</option>
              </select>
            </label>
          </header>

          <div class="camera-panel">
            <video id="camera-feed" playsinline muted></video>
            <canvas id="skeleton-canvas"></canvas>
            <div class="camera-overlay">
              <div class="badge" id="camera-status">Kamera inaktiv</div>
              <div class="feedback" id="training-feedback">
                <p class="title">Starte das Tracking</p>
                <p class="muted">KI überwacht Haltung & Bewegungsradius</p>
              </div>
              <div class="rep-counter">
                <p class="eyebrow">Wiederholungen</p>
                <div id="rep-count" class="big-number">0</div>
                <p id="tempo-info" class="muted">Tempo: —</p>
              </div>
            </div>
          </div>

          <div class="controls">
            <button class="btn primary" id="start-training">KI-Tracking starten</button>
            <button class="btn ghost" id="pause-training">Pause</button>
            <button class="btn secondary" id="save-set">Satz speichern</button>
            <button class="btn" id="stop-training" style="background: #dc2626; color: white;">Training beenden</button>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Sätze & Technik</h3>
              <span class="muted">Automatisch erfasst</span>
            </div>
            <div id="sets-list" class="stack"></div>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Pose Replay</h3>
              <button class="tiny-btn" id="play-replay">Replay ansehen</button>
            </div>
            <div id="replay-log" class="stack"></div>
          </div>
        </section>

        <section id="nutrition" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Food Scan</p>
              <h2>Mahlzeit scannen & Makros</h2>
              <p class="muted">
                Foto aufnehmen oder hochladen. KI erkennt Zutaten, Portion und Makros. Du kannst korrigieren.
              </p>
            </div>
            <label class="chip">
              Portion
              <input type="range" id="portion-slider" min="0.5" max="2" step="0.1" value="1" />
            </label>
          </header>

          <div class="upload-card">
            <label class="upload-area">
              <input type="file" id="food-input" accept="image/*" capture="environment" />
              <div>
                <p class="title">Mahlzeit fotografieren</p>
                <p class="muted">Automatische Analyse der Lebensmittel</p>
              </div>
            </label>
            <div class="preview">
              <img id="food-preview" alt="Food Preview" />
              <div id="food-details"></div>
            </div>
            <button class="btn primary" id="save-food">Zum Tagebuch hinzufügen</button>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Kalorienrechner</h3>
              <span class="muted">Dein Tagesbedarf</span>
            </div>
            <form id="calorie-calculator-form" class="form-grid">
              <label>
                Geschlecht
                <select id="calc-gender">
                  <option value="männlich">Männlich</option>
                  <option value="weiblich">Weiblich</option>
                  <option value="divers">Divers</option>
                </select>
              </label>
              <label>
                Alter
                <input type="number" id="calc-age" min="16" max="90" value="28" />
              </label>
              <label>
                Körpergröße (cm)
                <input type="number" id="calc-height" min="140" max="220" value="175" />
              </label>
              <label>
                Gewicht (kg)
                <input type="number" id="calc-weight" min="40" max="200" value="70" />
              </label>
              <label style="grid-column: 1 / -1;">
                Körperliche Aktivität
                <select id="calc-activity">
                  <option value="sedentary">Kaum aktiv (Bürojob, wenig Bewegung)</option>
                  <option value="light">1-2× Sport/Woche</option>
                  <option value="moderate" selected>3-5× Sport/Woche</option>
                  <option value="very">Täglich / sehr aktiv</option>
                </select>
              </label>
              <label style="grid-column: 1 / -1;">
                Ziel
                <select id="calc-goal">
                  <option value="bulk">Muskelaufbau</option>
                  <option value="cut">Fettabbau</option>
                  <option value="maintain" selected>Gewicht halten</option>
                </select>
              </label>
              <button class="btn primary full" type="submit" style="grid-column: 1 / -1;">Berechnen</button>
            </form>
            <div id="calorie-results" class="nutrition-results"></div>
          </div>

          <div class="card log-card" id="nutrition-progress-card" style="display: none;">
            <div class="block-header">
              <h3>Dein Fortschritt</h3>
              <span class="muted">Heutige Bilanz</span>
            </div>
            <div id="nutrition-progress" class="nutrition-progress-bars"></div>
          </div>

          <div class="card log-card">
            <div class="block-header">
              <h3>Tagebuch</h3>
              <span class="muted">Kalorien & Makros</span>
            </div>
            <div id="food-log" class="stack"></div>
          </div>
        </section>

        <section id="plan" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Planer</p>
              <h2>Automatisch generierter Trainingsplan</h2>
              <p class="muted">
                KI berücksichtigt Ziel, Level, Frequenz und Equipment. Anpassungen jederzeit möglich.
              </p>
            </div>
          </header>

          <form id="plan-form" class="card form-card">
            <div class="form-grid">
              <label>
                Alter
                <input type="number" id="age" min="16" max="90" value="28" />
              </label>
              <label>
                Geschlecht
                <select id="gender">
                  <option value="divers">Divers</option>
                  <option value="weiblich">Weiblich</option>
                  <option value="männlich">Männlich</option>
                </select>
              </label>
              <label>
                Größe (cm)
                <input type="number" id="height" min="140" max="210" value="178" />
              </label>
              <label>
                Gewicht (kg)
                <input type="number" id="weight" min="45" max="160" value="75" />
              </label>
              <label>
                Level
                <select id="level">
                  <option value="anfänger">Anfänger</option>
                  <option value="mittel">Mittel</option>
                  <option value="fortgeschritten">Fortgeschritten</option>
                </select>
              </label>
              <label>
                Ziel
                <select id="goal">
                  <option value="aufbau">Muskelaufbau</option>
                  <option value="fatloss">Fettabbau</option>
                  <option value="performance">Performance</option>
                </select>
              </label>
              <label>
                Häufigkeit (pro Woche)
                <input type="number" id="frequency" min="2" max="6" value="3" />
              </label>
              <label>
                Verfügbare Geräte
                <select id="equipment">
                  <option value="körpergewicht">Körpergewicht</option>
                  <option value="kurzhanteln">Kurzhanteln</option>
                  <option value="studio">Studio (volle Ausstattung)</option>
                </select>
              </label>
            </div>
            <button class="btn primary full" type="submit">Plan aktualisieren</button>
          </form>

          <div class="card log-card">
            <div class="block-header">
              <h3>Wöchentlicher Plan</h3>
              <span class="muted" id="plan-summary">Aktualisiert</span>
            </div>
            <div id="plan-days" class="stack"></div>
          </div>
        </section>

        <section id="profile" class="view">
          <header class="section-header">
            <div>
              <p class="eyebrow">Datenschutz & Geräte</p>
              <h2>Profil & Einstellungen</h2>
              <p class="muted">Kamera-Opt-in, Einheiten, Wearables.</p>
            </div>
          </header>
          <div class="card form-card">
            <label class="toggle">
              <span>Kamera für Training erlauben</span>
              <input type="checkbox" id="camera-consent" />
            </label>
            <label class="toggle">
              <span>Push-Hinweise & Vibration</span>
              <input type="checkbox" id="notification-toggle" checked />
            </label>
            <label class="toggle">
              <span>Wearable verbunden</span>
              <input type="checkbox" id="wearable-toggle" />
            </label>
            <p class="muted small">
              Consent kann jederzeit geändert werden. Rohvideos werden nicht gespeichert – nur Keypoints oder Snapshots nach Zustimmung.
            </p>
            <button class="btn secondary full" id="reset-progress" style="margin-top: 16px;">
              Reset Progress
            </button>
          </div>

          <!-- Data Management Section -->
          <div class="card form-card" style="margin-top: 16px;">
            <div style="margin-bottom: 12px;">
              <strong>Datenverwaltung</strong>
              <p class="muted small">Exportiere deine Daten als Backup oder stelle ein vorheriges Backup wieder her.</p>
            </div>
            <button class="btn primary full" id="export-backup" style="margin-bottom: 12px;">
              ⬇️ Backup speichern
            </button>
            <button class="btn ghost full" id="import-backup">
              ⬆️ Backup laden
            </button>
            <input type="file" id="import-file" accept=".json" style="display: none;" />
          </div>
        </section>
      </main>

      <nav class="bottom-nav">
        <button class="nav-btn active" data-target="dashboard">Dashboard</button>
        <button class="nav-btn" data-target="training">Training</button>
        <button class="nav-btn" data-target="nutrition">Ernährung</button>
        <button class="nav-btn" data-target="plan">Plan</button>
        <button class="nav-btn" data-target="profile">Profil</button>
      </nav>
    </div>
  </body>
</html>
